{% extends "base.html" %}

{% block extra_css %}
<style>
    #map {
        height: 400px;
        width: 100%;
        margin-top: 20px;
        border-radius: 10px;
    }
    .restaurant-card {
        transition: transform 0.3s ease;
    }
    .restaurant-card:hover {
        transform: translateY(-5px);
    }
    
    /* 搜尋按鈕樣式 */
    .search-button {
        transition: opacity 0.3s ease;
    }
    .search-button:disabled {
        cursor: not-allowed;
        opacity: 0.7;
    }
    .search-button:disabled .button-text::after {
        content: ' (載入中...)';
    }
</style>
{% endblock %}

{% block content %}
<div class="row">
    <!-- 搜尋區域 -->
    <div class="col-md-4">
        <div class="card shadow-sm">
            <div class="card-body">
                <h5 class="card-title mb-4"><i class="fas fa-search"></i> 搜尋餐廳</h5>
                <form id="searchForm">
                    <div class="mb-3">
                        <label for="address" class="form-label">地址</label>
                        <input type="text" class="form-control" id="address" required
                               placeholder="輸入地址...">
                    </div>
                    <div class="mb-3">
                        <label for="type" class="form-label">餐廳類型</label>
                        <select class="form-select" id="type">
                            <option value="">所有類型</option>
                            {% for type in config.RESTAURANT_TYPES %}
                            <option value="{{ type.id }}">{{ type.name }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="mb-3">
                        <label for="radius" class="form-label">搜尋範圍</label>
                        <select class="form-select" id="radius">
                            {% for option in config.SEARCH_RADIUS_OPTIONS %}
                            <option value="{{ option.value }}"
                                    {% if option.value == config.DEFAULT_SEARCH_RADIUS %}selected{% endif %}>
                                {{ option.name }}
                            </option>
                            {% endfor %}
                        </select>
                    </div>
                    <button type="submit" class="btn btn-primary w-100 search-button" disabled>
                        <i class="fas fa-search"></i> <span class="button-text">地圖載入中</span>
                    </button>
                </form>
            </div>
        </div>
    </div>

    <!-- 地圖和結果顯示區域 -->
    <div class="col-md-8">
        <!-- 地圖 -->
        <div id="map" class="shadow-sm"></div>
        
        <!-- 結果列表 -->
        <div id="resultsList" class="mt-4">
            <div class="d-flex justify-content-between align-items-center mb-3">
                <h5><i class="fas fa-utensils"></i> 搜尋結果</h5>
                <button id="randomButton" class="btn btn-success" style="display: none;">
                    <i class="fas fa-random"></i> 隨機選擇
                </button>
            </div>
            <div id="restaurantList" class="row g-3">
                <!-- 餐廳卡片將在此動態生成 -->
            </div>
        </div>
    </div>
</div>

<!-- 餐廳詳細資訊 Modal -->
<div class="modal fade" id="restaurantModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">餐廳詳細資訊</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <!-- 詳細資訊將在此動態生成 -->
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    window.googleMapsApiKey = "{{ config.GOOGLE_MAPS_API_KEY }}";
</script>
<!-- Google Maps JavaScript API -->
<script src="https://maps.googleapis.com/maps/api/js?key={{ config.GOOGLE_MAPS_API_KEY }}&libraries=places&callback=initMap" async defer></script>
<!-- 地圖處理 JavaScript -->
<script src="{{ url_for('static', filename='js/maps.js') }}"></script>
<!-- 主要功能 JavaScript -->
<script src="{{ url_for('static', filename='js/main.js') }}"></script>
{% endblock %}